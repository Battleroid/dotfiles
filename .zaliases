# vim:syntax=zsh ft=zsh

# Misc
alias notify="terminal-notifier"
alias rake="noglob rake"
alias wtfzsh="vim ~/.zshrc"
alias read="vim -R"
alias updatevim="vim +PlugUpdate +q +q"
alias reloadaliases="source ~/.zaliases"
alias tmux="tmux -2"
# alias tmux="TERM=screen-256color tmux -2"
alias fabtime="pyenv shell fab"
alias top=htop

# Functions
function epochtodate { date -d @$1 }
function curljq { curl -s $1 | jq } # no more curl ... | jq
function epoch { date +%s } # no more 'what is the date format for epoch'
function ctx { http --session general --auth cweed $@ }
function joinby { local IFS="$1"; shift; echo "$*"; }
function dock {
    case $1 in
    burn-last)
        last=$(docker ps -f status=running -q | head -1)
        docker kill $last
        docker rm $last
        ;;
    kill-last)
        last=$(docker ps -f status=running -q | head -1)
        docker kill $last
        ;;
    stop-last)
        last=$(docker ps -f status=running -q | head -1)
        docker stop $last
        ;;
    last-running-id)
        last=$(docker ps -f status=running -q | head -1)
        echo $last
        ;;
    last-built-id)
        last=$(docker images -q | head -1)
        echo $last
        ;;
    exec-bash)
        last=$(docker ps -f status=running -q | head -1)
        if [ -z $last ]; then
            echo "==> No running containers, exiting"
            return 1
        fi
        docker exec -it $last /bin/bash
        ;;
    exec-something)
        last=$(docker ps -f status=running -q | head -1)
        if [ -z $last ] || [ -z $2 ]; then
            echo "==> No running containers or missing command"
            return 1
        fi
        docker exec -it $last $2
        ;;
    clean)
        docker images -f dangling=true -q | xargs docker rmi
        ;;
    *)
        cat <<EOF
# dock (command) [options, args, etc]

Silly shortcuts and aliases for doing mundane Docker
related processes. I should really make this into a
proper ZSH plugin with completion sometime.

burn-last:       Kill and remove the last container
kill-last:       Kill last running container
stop-last:       Stop last running container
last-running-id: Get last running container ID
last-built-id:   Get last built image ID
exec-bash:       Start bash in the last running container
exec-something:  Start something other than bash
clean:           Clear out all dangling images
EOF
        ;;
    esac
}
